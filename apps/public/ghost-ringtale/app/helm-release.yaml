---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: ghost-ringtale
spec:
  interval: 5m
  chart:
    spec:
      chart: app-template
      version: 1.5.1
      sourceRef:
        kind: HelmRepository
        name: bjw-s-charts
        namespace: flux-system
  values:
    image:
      repository: ghost
      tag: 5.70.1
    service:
      main:
        ports:
          http:
            enabled: true
            port: 2368
    env:
      url: "https://${SECONDARY_HOSTNAME}" 
      database__client: sqlite3
      database__connection__filename: content/data/ghost.db
      database__useNullAsDefault: true
      database__debug: false
      mail__transport: SMTP
      mail__options__service: Sendgrid
      mail__options__host: smtp.sendgrid.net
      mail__options__port: 587
      mail__options__auth__user: apikey
      mail__options__auth__pass: "${MAIL_PASS}"
    persistence:
      config:
        enabled: true
        existingClaim: ghost-data
        mountPath: /var/lib/ghost/content